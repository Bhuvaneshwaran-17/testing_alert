name: Integrated Multi-Task Pipeline
on:
  push:
    branches: [ main ]

jobs:
  Task_1_Build_Monitor:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Run Build
        run: echo "Simulating Build..."

  Task_2_Env_Check:
    runs-on: ubuntu-latest
    steps:
      - name: Check Secret
        run: |
          if [ -z "${{ secrets.MANDATORY_CONFIG_VAR }}" ]; then
            exit 1
          fi
      - name: Alert Task 2 Failure
        if: failure()
        env:
          TEAMS_URL: ${{ secrets.TESTING_WEBHOOK }}
        run: |
          curl -H 'Content-Type: application/json' \
          -d '{"text": "ðŸš¨ TASK 2 FAILURE: Environment Variable is missing!"}' "$TEAMS_URL"

  Task_3_Config_Check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Check appsettings.json
        run: |
          if [ ! -f appsettings.json ] || ! grep -q "DatabaseConnectionString" appsettings.json; then
            exit 1
          fi
      - name: Alert Task 3 Failure
        if: failure()
        env:
          TEAMS_URL: ${{ secrets.TESTING_WEBHOOK }}
        run: |
          curl -H 'Content-Type: application/json' \
          -d '{"text": "ðŸš¨ TASK 3 FAILURE: Config Key is missing!"}' "$TEAMS_URL"